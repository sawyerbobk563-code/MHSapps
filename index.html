<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>MHS Daily Schedule â€¢ 2025-2026</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MHS Schedule">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#020617">
  
  <!-- Updated: PWA App Logo with black M -->
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect x='5' y='5' width='190' height='190' rx='40' ry='40' fill='%233b82f6'/%3E%3Ctext x='100' y='125' text-anchor='middle' font-family='Arial' font-size='110' font-weight='bold' fill='black' stroke='black' stroke-width='1.5'%3EM%3C/text%3E%3C/svg%3E">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect x='5' y='5' width='190' height='190' rx='40' ry='40' fill='%233b82f6'/%3E%3Ctext x='100' y='125' text-anchor='middle' font-family='Arial' font-size='110' font-weight='bold' fill='black' stroke='black' stroke-width='1.5'%3EM%3C/text%3E%3C/svg%3E">
  <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22MHS%20Schedule%22,%22short_name%22:%22MHS%20Schedule%22,%22description%22:%22Minneapolis%20High%20School%20Daily%20Schedule%202025-2026%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23020617%22,%22theme_color%22:%22%233b82f6%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%253Csvg%2520xmlns='http://www.w3.org/2000/svg'%2520viewBox='0%25200%2520200%2520200'%253E%253Crect%2520x='5'%2520y='5'%2520width='190'%2520height='190'%2520rx='40'%2520ry='40'%2520fill='%25233b82f6'/%253E%253Ctext%2520x='100'%2520y='125'%2520text-anchor='middle'%2520font-family='Arial'%2520font-size='110'%2520font-weight='bold'%2520fill='black'%2520stroke='black'%2520stroke-width='1.5'%253EM%253C/text%253E%253C/svg%253E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%22}]}">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Preload critical fonts to ensure they load -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Crimson+Pro:wght@400;700&family=Fredoka:wght@400;700&family=Space+Grotesk:wght@400;700&family=Lobster&family=Georgia&family=Courier+Prime&family=Pacifico&family=Comic+Neue:wght@700&family=Bangers&family=Press+Start+2P&family=Dancing+Script:wght@700&family=Indie+Flower&family=Shadows+Into+Light&family=Amatic+SC:wght@700&family=Rubik+Glitch&family=Rubik+Wet+Paint&family=Rubik+Maze&family=Rubik+Bubbles&family=Monoton&family=Fredericka+the+Great&family=Righteous&family=Black+Ops+One&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;700&family=Audiowide&family=Kdam+Thmor+Pro&family=Smokum&family=Stalinist+One&family=Trade+Winds&family=UnifrakturMaguntia&family=VT323&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* Loading Animation Styles */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    #loading-screen.fade-out {
      opacity: 0;
      visibility: hidden;
    }
    
    .loader {
      width: 120px;
      height: 22px;
      border-radius: 40px;
      color: #514b82;
      border: 2px solid;
      position: relative;
      overflow: hidden;
    }
    
    .loader::before {
      content: "";
      position: absolute;
      margin: 2px;
      width: 14px;
      top: 0;
      bottom: 0;
      left: -20px;
      border-radius: inherit;
      background: currentColor;
      box-shadow: -10px 0 12px 3px currentColor;
      clip-path: polygon(0 5%, 100% 0,100% 100%,0 95%,-30px 50%);
      animation: l14 1s infinite linear;
    }
    
    @keyframes l14 {
      100% {left: calc(100% + 20px)}
    }
    
    .loading-text {
      margin-top: 20px;
      color: var(--text-main);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
    }

    /* DVD Bouncing Effect - Enhanced with more unpredictable bouncing */
    .dvd-bouncing-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      overflow: hidden;
    }
    
    .dvd-logo {
      position: absolute;
      width: 80px;
      height: 40px;
      background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      opacity: 0.15;
    }
    
    /* Rain Background Effect */
    .rain-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      overflow: hidden;
    }
    
    .raindrop {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(to bottom, transparent, var(--accent-primary));
      animation: rainFall linear infinite;
      border-radius: 0 0 2px 2px;
    }
    
    .raindrop::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      background: var(--accent-secondary);
      border-radius: 50%;
      opacity: 0.6;
    }
    
    @keyframes rainFall {
      0% {
        transform: translateY(-100px);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(100vh);
        opacity: 0;
      }
    }
    
    /* Timer last minute pulse animation */
    .timer-pulse {
      animation: pulse 1s infinite alternate;
    }
    
    @keyframes pulse {
      from {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
      }
      to {
        transform: scale(1.05);
        box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0.4);
      }
    }
    
    :root {
      --bg-color: #020617;
      --accent-primary: #3b82f6;
      --accent-secondary: #8b5cf6;
      --card-bg: rgba(15, 23, 42, 0.6);
      --card-border: rgba(255, 255, 255, 0.08);
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
      --settings-spacing: 1rem;
      
      /* Animation speed */
      --animation-speed: 1;
      
      /* Background effect setting */
      --background-effect: 'none';
      
      /* Custom theme colors */
      --custom-primary: #3b82f6;
      --custom-secondary: #8b5cf6;
      --custom-bg: #020617;
    }

    @media (prefers-reduced-motion: reduce) {
      :root {
        --animation-speed: 0.5;
      }
    }

    body.motion-reduced {
      --animation-speed: 0.3;
    }

    .container {
      animation-duration: calc(0.8s * var(--animation-speed));
    }
    .dropdown-content {
      animation-duration: calc(0.3s * var(--animation-speed));
    }
    .dropdown-content {
      transition-duration: calc(0.3s * var(--animation-speed));
    }

    /* Updated: Added transition for day switching */
    .schedule-transition {
      transition: all calc(0.4s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 1;
      transform: translateY(0);
    }
    
    .schedule-transition.fade-out {
      opacity: 0;
      transform: translateY(10px);
    }

    /* Themes */
    body.theme-midnight { --bg-color: #020617; --accent-primary: #3b82f6; --accent-secondary: #8b5cf6; }
    body.theme-emerald { --accent-primary: #10b981; --accent-secondary: #3b82f6; --bg-color: #022c22; }
    body.theme-rose { --accent-primary: #f43f5e; --accent-secondary: #fb923c; --bg-color: #1c0a0a; }
    body.theme-ocean { --accent-primary: #0ea5e9; --accent-secondary: #6366f1; --bg-color: #0c1a30; }
    body.theme-sunset { --accent-primary: #f59e0b; --accent-secondary: #ef4444; --bg-color: #2d1b0d; }
    body.theme-citrus { --accent-primary: #eab308; --accent-secondary: #22c55e; --bg-color: #061a06; }
    body.theme-purple { --accent-primary: #8b5cf6; --accent-secondary: #ec4899; --bg-color: #1e0b42; }
    body.theme-cyber { --accent-primary: #00ff9d; --accent-secondary: #00b8ff; --bg-color: #0a0a1a; }
    body.theme-custom { 
      --accent-primary: var(--custom-primary);
      --accent-secondary: var(--custom-secondary);
      --bg-color: var(--custom-bg);
    }

    /* Updated: Added more unique font classes */
    body.font-sans { --font-family: 'Plus Jakarta Sans', sans-serif; }
    body.font-serif { --font-family: 'Crimson Pro', serif; }
    body.font-mono { --font-family: 'JetBrains Mono', monospace; }
    body.font-tech { --font-family: 'Space Grotesk', sans-serif; }
    body.font-lobster { --font-family: 'Lobster', cursive; }
    body.font-georgia { --font-family: 'Georgia', serif; }
    body.font-courier { --font-family: 'Courier Prime', monospace; }
    body.font-pacifico { --font-family: 'Pacifico', cursive; }
    body.font-comic { --font-family: 'Comic Neue', cursive; }
    body.font-bangers { --font-family: 'Bangers', cursive; letter-spacing: 0.05em; }
    body.font-retro { --font-family: 'Press Start 2P', cursive; font-size: 0.9em; }
    body.font-dancing { --font-family: 'Dancing Script', cursive; }
    body.font-indie { --font-family: 'Indie Flower', cursive; }
    body.font-shadows { --font-family: 'Shadows Into Light', cursive; }
    body.font-amatic { --font-family: 'Amatic SC', cursive; font-weight: 700; }
    body.font-glitch { --font-family: 'Rubik Glitch', cursive; }
    body.font-wetpaint { --font-family: 'Rubik Wet Paint', cursive; }
    body.font-maze { --font-family: 'Rubik Maze', cursive; }
    body.font-bubbles { --font-family: 'Rubik Bubbles', cursive; }
    body.font-monoton { --font-family: 'Monoton', cursive; letter-spacing: 0.1em; }
    body.font-fredericka { --font-family: 'Fredericka the Great', cursive; }
    body.font-righteous { --font-family: 'Righteous', cursive; }
    body.font-blackops { --font-family: 'Black Ops One', cursive; }
    body.font-orbitron { --font-family: 'Orbitron', sans-serif; font-weight: 700; }
    body.font-rajdhani { --font-family: 'Rajdhani', sans-serif; font-weight: 700; }
    body.font-audiowide { --font-family: 'Audiowide', cursive; }
    body.font-kdam { --font-family: 'Kdam Thmor Pro', sans-serif; }
    body.font-smokum { --font-family: 'Smokum', cursive; letter-spacing: 0.05em; }
    body.font-stalinist { --font-family: 'Stalinist One', cursive; }
    body.font-tradewinds { --font-family: 'Trade Winds', cursive; }
    body.font-unifraktur { --font-family: 'UnifrakturMaguntia', cursive; }
    body.font-vt323 { --font-family: 'VT323', monospace; }

    /* Added: Anchor time font color */
    .anchor-name {
      font-weight: 700;
      color: #10b981 !important; /* Green color for anchor time */
    }

    /* Sign Mode adjustments */
    body.mode-sign .lunch-section-header,
    body.mode-sign .lunch-picker,
    body.mode-sign .dropdown,
    body.mode-sign .bottom-bar,
    body.mode-sign .date-nav,
    body.mode-sign .creator-credit-bar { display: none !important; }
    body.mode-sign .container { max-width: 1000px; padding-top: 5vh; }
    body.mode-sign .timer-outer-wrapper { width: 450px; height: 450px; margin-bottom: 4rem; }
    body.mode-sign #timer { font-size: 8rem; }
    body.mode-sign #current-period { font-size: 2rem; }
    body.mode-sign .glass-card { font-size: 1.2rem; }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: var(--font-family);
      background-color: var(--bg-color);
      color: var(--text-main);
      min-height: 100vh;
      padding: env(safe-area-inset-top, 2rem) env(safe-area-inset-right, 1rem) env(safe-area-inset-bottom, 8rem) env(safe-area-inset-left, 1rem);
      transition: background-color 0.4s ease, font-family 0.2s ease;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated Particle Background */
    #particles-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      opacity: 0.7;
      transition: opacity 0.5s ease;
    }

    /* Hide particles when motion is reduced or background effect is changed */
    body.motion-reduced #particles-canvas,
    body.background-effect-none #particles-canvas,
    body.background-effect-gradient #particles-canvas,
    body.background-effect-bubbles #particles-canvas,
    body.background-effect-grid #particles-canvas,
    body.background-effect-dvd #particles-canvas,
    body.background-effect-rain #particles-canvas {
      opacity: 0;
    }

    /* Static gradient background */
    .static-gradient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, var(--bg-color) 100%);
      background-size: 400% 400%;
    }
    
    body.background-effect-gradient .static-gradient-bg {
      opacity: 0.15;
    }
    
    body.background-effect-none .static-gradient-bg,
    body.background-effect-particles .static-gradient-bg,
    body.background-effect-bubbles .static-gradient-bg,
    body.background-effect-grid .static-gradient-bg,
    body.background-effect-dvd .static-gradient-bg,
    body.background-effect-rain .static-gradient-bg {
      opacity: 0;
    }

    /* Bubbles Background */
    .bubbles-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      overflow: hidden;
    }
    
    .bubble {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.05);
      animation: float calc(10s * var(--animation-speed)) infinite ease-in-out;
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0) translateX(0);
      }
      25% {
        transform: translateY(-30px) translateX(15px);
      }
      50% {
        transform: translateY(-60px) translateX(-15px);
      }
      75% {
        transform: translateY(-30px) translateX(15px);
      }
    }
    
    body.background-effect-bubbles .bubbles-bg {
      opacity: 1;
    }

    /* Updated: Animated Grid Dots Background - Made faster and dots bigger */
    .grid-dots-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      background-image: 
        radial-gradient(circle at 1px 1px, var(--accent-primary) 3px, transparent 0), /* Bigger dots: 3px instead of 1px */
        radial-gradient(circle at 21px 21px, var(--accent-secondary) 3px, transparent 0); /* Bigger dots: 3px instead of 1px */
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      filter: brightness(1.5);
      animation: gridMove calc(20s * var(--animation-speed)) infinite linear; /* Updated: Faster - 20s instead of 40s */
    }
    
    @keyframes gridMove {
      0% {
        background-position: 0 0, 20px 20px;
      }
      100% {
        background-position: 40px 40px, 60px 60px;
      }
    }
    
    body.background-effect-grid .grid-dots-bg {
      opacity: 0.3;
    }

    /* DVD Background */
    body.background-effect-dvd .dvd-bouncing-bg {
      opacity: 1;
    }

    /* Rain Background */
    body.background-effect-rain .rain-bg {
      opacity: 1;
    }

    /* Settings spacing */
    body.settings-open {
      padding-bottom: calc(8rem + var(--settings-spacing));
    }
    
    body:not(.settings-open) {
      padding-bottom: calc(8rem + 2rem);
    }

    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      opacity: 0; 
      transform: translateY(20px); 
      animation: reveal calc(0.8s * var(--animation-speed)) ease forwards; 
      transition: max-width 0.5s ease, transform 0.3s ease; 
      position: relative;
      z-index: 1;
    }
    
    @keyframes reveal { 
      to { 
        opacity: 1; 
        transform: translateY(0); 
      } 
    }

    /* Toast notification */
    #toast-notification {
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%) scale(0.9);
      opacity: 0;
      background: var(--accent-primary); 
      color: white; 
      padding: 0.85rem 1.75rem;
      border-radius: 2rem; 
      font-weight: 800; 
      font-size: 0.95rem; 
      z-index: 1001;
      box-shadow: 0 25px 50px rgba(0,0,0,0.7), 0 0 30px rgba(59, 130, 246, 0.5); 
      transition: all calc(0.6s * var(--animation-speed)) cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none; 
      border: 2px solid rgba(255,255,255,0.2);
      text-align: center;
      white-space: nowrap;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    #toast-notification.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    /* Save to Home Notification */
    #save-to-home-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      opacity: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      color: white;
      padding: 1.5rem 2rem;
      border-radius: 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      z-index: 2000;
      box-shadow: 0 25px 50px rgba(0,0,0,0.8), 0 0 40px rgba(59, 130, 246, 0.4);
      border: 1px solid var(--card-border);
      text-align: center;
      max-width: 90%;
      width: 400px;
      transition: all calc(0.6s * var(--animation-speed)) cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none;
    }
    
    #save-to-home-notification.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events: all;
    }
    
    #save-to-home-notification .notification-title {
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 0.75rem;
      color: var(--accent-primary);
    }
    
    #save-to-home-notification .notification-content {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 1.25rem;
      color: var(--text-muted);
    }
    
    #save-to-home-notification .notification-buttons {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
    }
    
    #save-to-home-notification .notification-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
    }
    
    #save-to-home-notification .notification-btn-primary {
      background: var(--accent-primary);
      color: white;
    }
    
    #save-to-home-notification .notification-btn-primary:hover {
      background: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.5);
    }
    
    #save-to-home-notification .notification-btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-main);
      border: 1px solid var(--card-border);
    }
    
    #save-to-home-notification .notification-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    header { 
      text-align: center; 
      margin-bottom: 1.5rem; 
      position: relative; 
    }

    /* Date Navigation */
    .date-nav {
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 10;
    }
    .nav-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--card-border);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .nav-btn:hover { 
      background: rgba(255, 255, 255, 0.1); 
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 15px rgba(59, 130, 246, 0.3);
    }
    .nav-btn:active { transform: scale(0.9); }
    .today-btn {
      font-size: 0.65rem;
      font-weight: 800;
      text-transform: uppercase;
      padding: 0.4rem 0.7rem;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 2rem;
      color: var(--accent-primary);
      cursor: pointer;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .today-btn:hover { 
      background: var(--accent-primary); 
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.4);
    }

    /* Updated: Bubble glass effect for day and time - Added seconds */
    .datetime-bubble {
      display: inline-block;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 1.5rem;
      padding: 0.6rem 1.2rem;
      margin: 0.5rem 0 1rem 0;
      box-shadow: 0 15px 35px rgba(0,0,0,0.6), 0 0 20px rgba(59, 130, 246, 0.2);
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 260px;
    }

    .datetime-bubble:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.7), 0 0 25px rgba(59, 130, 246, 0.3);
    }

    .datetime-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .day-display {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent-primary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Updated: Time display with seconds */
    .time-display {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-main);
      font-variant-numeric: tabular-nums;
    }
    
    .time-display-with-seconds {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-main);
      font-variant-numeric: tabular-nums;
    }

    .selected-day-indicator {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent-secondary);
      margin-top: 0.25rem;
      opacity: 0.9;
    }

    .badge { 
      display: inline-block; 
      padding: 0.25rem 0.85rem; 
      background: rgba(59, 130, 246, 0.1); 
      border: 1px solid rgba(59, 130, 246, 0.2); 
      border-radius: 999px; 
      color: var(--accent-primary); 
      font-size: 0.8rem; 
      font-weight: 800; 
      text-transform: uppercase; 
      margin-bottom: 0.5rem; 
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    
    h1 { 
      font-size: 2.2rem; 
      font-weight: 800; 
      letter-spacing: -0.03em; 
      background: linear-gradient(to right, #fff, #94a3b8); 
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent; 
      margin-top: 1rem; 
    }
    
    /* Updated: Date and time display with seconds */
    #current-date-time { 
      color: var(--text-muted); 
      font-size: 0.95rem; 
      margin-top: 0.25rem; 
      font-variant-numeric: tabular-nums; 
      font-weight: 500; 
    }
    
    .viewing-indicator { 
      font-size: 0.75rem; 
      color: var(--accent-secondary); 
      font-weight: 700; 
      margin-top: 0.5rem; 
      display: none; 
    }
    .viewing-indicator.visible { display: block; }

    /* Timer */
    .timer-outer-wrapper { 
      position: relative; 
      width: 300px; 
      height: 300px; 
      margin: 1.5rem auto 2.5rem; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      transition: all calc(0.5s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1); 
      overflow: hidden;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.6));
    }
    .timer-outer-wrapper.hidden { height: 0; margin: 0; opacity: 0; pointer-events: none; }

    .progress-ring { position: absolute; top: 0; left: 0; transform: rotate(-90deg); width: 100%; height: 100%; }
    .timer-content { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; width: 100%; pointer-events: none; padding-top: 5px; }
    #timer { 
      font-size: 5.5rem; 
      font-weight: 800; 
      font-variant-numeric: tabular-nums; 
      line-height: 1; 
      color: #fff; 
      text-shadow: 0 0 40px rgba(59, 130, 246, 0.4); 
      transition: color 0.3s ease;
    }
    #current-period { 
      font-size: 1.1rem; 
      font-weight: 700; 
      color: var(--accent-primary); 
      margin-top: 0.25rem; 
      transition: color 0.3s ease;
    }
    .timer-label { 
      text-transform: uppercase; 
      font-size: 0.7rem; 
      letter-spacing: 0.2em; 
      color: var(--text-muted); 
      opacity: 0.8; 
    }

    .glass-card { 
      background: var(--card-bg); 
      backdrop-filter: blur(20px); 
      -webkit-backdrop-filter: blur(20px); 
      border: 1px solid var(--card-border); 
      border-radius: 1.75rem; 
      overflow: hidden; 
      margin-bottom: 1.5rem; 
      box-shadow: 0 35px 70px rgba(0,0,0,0.8), 0 0 40px rgba(59, 130, 246, 0.3);
    }
    
    table { width: 100%; border-collapse: collapse; }
    th { padding: 1.25rem; text-align: left; color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; border-bottom: 1px solid var(--card-border); }
    
    td { padding: 1rem 1.25rem; border-bottom: 1px solid var(--card-border); font-size: 0.85rem; }
    tr.active-row td { background: rgba(59, 130, 246, 0.15); color: #fff; }
    .period-name { 
      font-weight: 700; 
      color: var(--accent-primary); 
    }
    .lunch-name { 
      font-weight: 700; 
      color: var(--accent-secondary); 
    }
    .time-cell { 
      font-variant-numeric: tabular-nums; 
      text-align: right; 
      color: var(--text-muted); 
      font-weight: 500; 
    }

    /* Lunch selector */
    .lunch-selector-section {
      margin-top: 1.5rem;
    }
    .lunch-section-header { 
      font-size: 0.7rem; 
      text-transform: uppercase; 
      letter-spacing: 0.1em; 
      color: var(--text-muted); 
      margin-bottom: 1rem; 
      font-weight: 800; 
      text-align: center; 
    }
    .lunch-picker { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 2rem; }
    .lunch-picker span { 
      display: block; padding: 0.85rem 0.25rem; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--card-border); border-radius: 1.25rem; font-size: 0.75rem; font-weight: 700; text-align: center; 
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; 
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .lunch-picker input { display: none; }
    .lunch-picker input:checked + span { 
      background: var(--accent-primary); color: white; border-color: var(--accent-primary); 
      box-shadow: 0 12px 35px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.4);
      transform: translateY(-2px);
    }

    .dropdown { position: relative; width: 100%; margin-top: 1rem; }
    .dropdown-btn { 
      width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--card-border); 
      border-radius: 1.25rem; color: var(--text-main); font-weight: 700; text-align: left; display: flex; 
      justify-content: space-between; align-items: center; cursor: pointer; 
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .dropdown-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.5), 0 0 15px rgba(59, 130, 246, 0.3);
    }
    .dropdown-content { 
      display: none; padding: 1rem 1.25rem; flex-direction: column; gap: 0.75rem; 
      background: rgba(0,0,0,0.2); border-bottom-left-radius: 1.25rem; border-bottom-right-radius: 1.25rem; 
      margin-top: -10px; border: 1px solid var(--card-border); border-top: none; 
      animation: dropdownFadeIn calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      max-height: 0;
      overflow: hidden;
      transition: max-height calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1), padding calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }
    .dropdown.open .dropdown-content { 
      display: flex; 
      max-height: 1500px;
      padding: 1rem 1.25rem;
    }
    .dropdown.closing .dropdown-content {
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
    }
    @keyframes dropdownFadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .arrow { transition: 0.3s; border: solid var(--text-muted); border-width: 0 2px 2px 0; display: inline-block; padding: 3px; transform: rotate(45deg); margin-right: 5px; }
    .dropdown.open .arrow { transform: rotate(225deg); }

    .bookmark-item { display: flex; align-items: center; gap: 0.5rem; width: 100%; }
    .bookmark-link {
      flex: 1; display: flex; align-items: center; gap: 0.75rem; padding: 0.85rem 1.25rem; 
      background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 1rem; 
      color: var(--text-main); text-decoration: none; font-size: 0.85rem; font-weight: 600; 
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .bookmark-link:hover { 
      transform: translateX(8px) translateY(-2px); 
      background: rgba(59, 130, 246, 0.15); 
      border-color: var(--accent-primary);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.3), 0 0 15px rgba(59, 130, 246, 0.2);
    }
    
    .delete-bm {
      background: rgba(244, 63, 94, 0.1); border: 1px solid rgba(244, 63, 94, 0.2); 
      color: #f43f5e; padding: 0.75rem; border-radius: 1rem; cursor: pointer;
      display: flex; align-items: center; justify-content: center; width: 44px; height: 44px;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .delete-bm:hover {
      background: rgba(244, 63, 94, 0.2);
      border-color: #f43f5e;
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(244, 63, 94, 0.3), 0 0 15px rgba(244, 63, 94, 0.2);
    }

    .settings-group { padding: 0.5rem 0; border-bottom: 1px solid var(--card-border); }
    .settings-group:last-child { border-bottom: none; }
    .settings-label { 
      font-size: 0.65rem; 
      text-transform: uppercase; 
      color: var(--text-muted); 
      margin-bottom: 0.75rem; 
      display: block; 
      letter-spacing: 0.05em; 
      font-weight: 800; 
    }
    .toggle-row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem; }
    .setting-pill {
      padding: 0.5rem 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--card-border);
      border-radius: 2rem; font-size: 0.75rem; color: var(--text-main); cursor: pointer; 
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .setting-pill:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.5), 0 0 15px rgba(59, 130, 246, 0.2);
    }
    .setting-pill.active { 
      background: var(--accent-primary); 
      border-color: var(--accent-primary); 
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.4);
    }
    
    /* Custom Theme Builder */
    .theme-builder {
      background: rgba(0,0,0,0.2);
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 0.5rem;
      border: 1px solid var(--card-border);
    }
    
    .color-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .color-input {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .color-input label {
      font-size: 0.75rem;
      font-weight: 600;
      min-width: 80px;
      color: var(--text-muted);
    }
    
    .color-input input[type="color"] {
      width: 40px;
      height: 40px;
      border: 2px solid var(--card-border);
      border-radius: 0.5rem;
      cursor: pointer;
      background: transparent;
    }
    
    .color-input input[type="text"] {
      flex: 1;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--card-border);
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      color: white;
      font-family: inherit;
      font-size: 0.75rem;
      outline: none;
    }
    
    .color-preview {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .preview-color {
      width: 30px;
      height: 30px;
      border-radius: 0.5rem;
      border: 1px solid var(--card-border);
    }
    
    .add-bookmark-form { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem; }
    .input-field { 
      background: rgba(0,0,0,0.3); border: 1px solid var(--card-border); border-radius: 0.75rem; padding: 0.85rem; 
      color: white; font-family: inherit; font-size: 0.85rem; outline: none; width: 100%;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .input-field:focus {
      border-color: var(--accent-primary);
      background: rgba(0,0,0,0.4);
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.3), 0 0 15px rgba(59, 130, 246, 0.2);
    }
    .save-btn { 
      padding: 0.85rem; background: var(--accent-primary); border: none; border-radius: 0.75rem; 
      color: white; font-weight: 700; cursor: pointer; font-size: 0.85rem; 
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    .save-btn:hover {
      background: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(59, 130, 246, 0.6), 0 0 25px rgba(59, 130, 246, 0.4);
    }
    .save-btn:active { transform: scale(0.98); opacity: 0.9; }

    .bottom-bar { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%); display: flex; gap: 0.5rem; z-index: 100; width: max-content; }
    .pill-info { 
      font-size: 0.65rem; font-weight: 800; color: var(--text-muted); background: rgba(15, 23, 42, 0.9); 
      backdrop-filter: blur(12px); padding: 0.5rem 1rem; border-radius: 2rem; border: 1px solid var(--card-border); 
      white-space: nowrap;
      transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    }
    .pill-info:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.7), 0 0 20px rgba(59, 130, 246, 0.3);
    }
    
    /* Creator Credit Bar */
    .creator-credit-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 24px;
      background: rgba(2, 6, 23, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-top: 1px solid var(--card-border);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99;
      font-size: 0.7rem;
      color: var(--text-muted);
      font-weight: 500;
      letter-spacing: 0.02em;
      opacity: 0;
      transform: translateY(100%);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    
    .creator-credit-bar.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    #exit-sign-mode {
        position: fixed; top: 1rem; right: 1rem; display: none; padding: 0.5rem 1rem;
        background: rgba(0,0,0,0.5); color: white; border-radius: 2rem; border: 1px solid rgba(255,255,255,0.2);
        cursor: pointer; z-index: 2000; font-size: 0.7rem; font-weight: 700;
        transition: all calc(0.3s * var(--animation-speed)) cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    }
    #exit-sign-mode:hover {
      background: rgba(0,0,0,0.7);
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 20px rgba(59, 130, 246, 0.4);
    }
    body.mode-sign #exit-sign-mode { display: block; }

    /* Custom SVG Icons */
    .icon { width: 18px; height: 18px; fill: currentColor; }

    @media (max-width: 480px) {
        .date-nav { position: relative; justify-content: center; margin-bottom: 0.5rem; }
        .lunch-picker { grid-template-columns: 1fr; }
        .toggle-row { justify-content: center; }
        #toast-notification {
          font-size: 0.85rem;
          padding: 0.75rem 1.5rem;
          white-space: normal;
          max-width: 90%;
        }
        #save-to-home-notification {
          width: 90%;
          padding: 1.25rem 1.5rem;
        }
        #save-to-home-notification .notification-buttons {
          flex-direction: column;
        }
        .creator-credit-bar {
          font-size: 0.65rem;
          height: 22px;
        }
        body:not(.settings-open) {
          padding-bottom: calc(8rem + 1.5rem);
        }
        .datetime-bubble {
          padding: 0.5rem 1rem;
          min-width: 220px;
        }
        .day-display {
          font-size: 0.9rem;
        }
        .time-display, .time-display-with-seconds {
          font-size: 0.8rem;
        }
        .selected-day-indicator {
          font-size: 0.7rem;
        }
    }
  </style>
</head>
<body class="font-sans">

<!-- Loading Screen -->
<div id="loading-screen">
  <div class="loader"></div>
  <div class="loading-text">Loading Schedule...</div>
</div>

<!-- DVD Bouncing Background -->
<div class="dvd-bouncing-bg" id="dvd-bg"></div>

<!-- Rain Background -->
<div class="rain-bg" id="rain-bg"></div>

<!-- Save to Home Notification -->
<div id="save-to-home-notification">
  <div class="notification-title">ðŸ“± Save to Home Screen</div>
  <div class="notification-content">Get quick access to the schedule by adding this app to your home screen for a fullscreen experience!</div>
  <div class="notification-buttons">
    <button class="notification-btn notification-btn-primary" onclick="dismissSaveNotification(true)">Got it!</button>
    <button class="notification-btn notification-btn-secondary" onclick="dismissSaveNotification(false)">Remind me later</button>
  </div>
</div>

<!-- Toast notification -->
<div id="toast-notification">ðŸŽ‰ Class is Over!</div>
<button id="exit-sign-mode" onclick="updateSetting('mode', 'standard')">Exit Sign Mode</button>

<!-- Animated Particle Background Canvas -->
<canvas id="particles-canvas"></canvas>

<!-- Static Gradient Background -->
<div class="static-gradient-bg"></div>

<!-- Bubbles Background -->
<div class="bubbles-bg" id="bubbles-bg"></div>

<!-- Grid Dots Background -->
<div class="grid-dots-bg"></div>

<!-- Creator Credit Bar -->
<div class="creator-credit-bar">
  created by: Sawyer Schulzâ€”035665@mtka.org
</div>

<div class="container">
  <header>
    <div class="date-nav">
      <button class="nav-btn" onclick="changeDate(-1)" aria-label="Previous Day">
        <svg viewBox="0 0 24 24" class="icon"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </button>
      <button class="today-btn" onclick="goToToday()">Today</button>
      <button class="nav-btn" onclick="changeDate(1)" aria-label="Next Day">
        <svg viewBox="0 0 24 24" class="icon"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
      </button>
    </div>

    <div class="badge" id="week-badge">Loading...</div>
    <h1 id="main-title">MHS Schedule</h1>
    
    <!-- Updated: Bubble glass effect for day and time - Shows full date and time with seconds -->
    <div class="datetime-bubble" id="datetime-bubble">
      <div class="datetime-content">
        <div class="day-display" id="current-day">Loading...</div>
        <!-- Updated: Added full date and time with seconds -->
        <div class="time-display-with-seconds" id="current-date-time-full">Loading...</div>
        <div class="selected-day-indicator" id="selected-day-indicator"></div>
      </div>
    </div>
    
    <div id="viewing-indicator" class="viewing-indicator">Viewing Future Schedule</div>
  </header>

  <!-- Timer wrapper -->
  <div class="timer-outer-wrapper" id="timer-wrapper">
    <svg class="progress-ring" viewBox="0 0 300 300">
      <circle stroke="rgba(255,255,255,0.03)" stroke-width="12" fill="transparent" r="140" cx="150" cy="150"/>
      <circle id="progress-bar" stroke="url(#grad)" stroke-width="12" stroke-dasharray="879.65" stroke-dashoffset="879.65" fill="transparent" r="140" cx="150" cy="150" stroke-linecap="round"/>
      <defs><linearGradient id="grad"><stop offset="0%" stop-color="var(--accent-primary)"/><stop offset="100%" stop-color="var(--accent-secondary)"/></linearGradient></defs>
    </svg>
    <div class="timer-content">
      <div class="timer-label" id="timer-label">Time Remaining</div>
      <div id="timer">00:00</div>
      <div id="current-period">Loading...</div>
    </div>
  </div>

  <!-- Updated: Added schedule-transition class -->
  <div class="glass-card schedule-transition" id="schedule-card">
    <table>
      <thead><tr><th>Period</th><th style="text-align:right">Time Window</th></tr></thead>
      <tbody id="schedule-body"></tbody>
    </table>
  </div>

  <!-- Lunch selector -->
  <div class="lunch-selector-section schedule-transition" id="lunch-selector">
    <div class="lunch-section-header">Lunch Selection</div>
    <div class="lunch-picker">
      <label><input type="radio" name="lunch" value="3"><span>4a (Lunch 3)<br><small>Late Lunch</small></span></label>
      <label><input type="radio" name="lunch" value="2"><span>4b (Lunch 2)<br><small>Split Period 4</small></span></label>
      <label><input type="radio" name="lunch" value="1"><span>4c (Lunch 1)<br><small>Early Lunch</small></span></label>
    </div>
  </div>

  <div class="dropdown" id="bookmark-dropdown">
    <button class="dropdown-btn" onclick="toggleDropdown('bookmark-dropdown')">
      <span>Quick Bookmarks</span>
      <i class="arrow"></i>
    </button>
    <div class="dropdown-content" id="bookmarks-list"></div>
  </div>

  <div class="dropdown" id="settings-dropdown">
    <button class="dropdown-btn" onclick="toggleDropdown('settings-dropdown')">
      <span>Settings & Customization</span>
      <i class="arrow"></i>
    </button>
    <div class="dropdown-content">
      <div class="settings-group">
        <span class="settings-label">Display Mode</span>
        <div class="toggle-row" id="mode-options">
          <div class="setting-pill" data-val="standard" onclick="updateSetting('mode', 'standard')">Standard</div>
          <div class="setting-pill" data-val="sign" onclick="updateSetting('mode', 'sign')">Sign/TV</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">Time Format</span>
        <div class="toggle-row" id="timeformat-options">
          <div class="setting-pill" data-val="12hr" onclick="updateSetting('timeformat', '12hr')">12hr (AM/PM)</div>
          <div class="setting-pill" data-val="24hr" onclick="updateSetting('timeformat', '24hr')">24hr</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">Background Effect</span>
        <div class="toggle-row" id="background-effect-options">
          <div class="setting-pill" data-val="none" onclick="updateSetting('background-effect', 'none')">None</div>
          <div class="setting-pill" data-val="particles" onclick="updateSetting('background-effect', 'particles')">Particles</div>
          <div class="setting-pill" data-val="gradient" onclick="updateSetting('background-effect', 'gradient')">Gradient</div>
          <div class="setting-pill" data-val="bubbles" onclick="updateSetting('background-effect', 'bubbles')">Bubbles</div>
          <div class="setting-pill" data-val="grid" onclick="updateSetting('background-effect', 'grid')">Grid Dots</div>
          <div class="setting-pill" data-val="dvd" onclick="updateSetting('background-effect', 'dvd')">DVD Bounce</div>
          <div class="setting-pill" data-val="rain" onclick="updateSetting('background-effect', 'rain')">Rain</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">Motion Settings</span>
        <div class="toggle-row" id="motion-options">
          <div class="setting-pill" data-val="normal" onclick="updateSetting('motion', 'normal')">Normal</div>
          <div class="setting-pill" data-val="reduced" onclick="updateSetting('motion', 'reduced')">Reduced</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">Celebrations</span>
        <div class="toggle-row" id="celebration-options">
          <div class="setting-pill" data-val="on" onclick="updateSetting('celebration', 'on')">On</div>
          <div class="setting-pill" data-val="off" onclick="updateSetting('celebration', 'off')">Off</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">Font Style</span>
        <!-- Updated: Added more unique font options -->
        <div class="toggle-row" id="font-options">
          <div class="setting-pill" data-val="sans" onclick="updateSetting('font', 'sans')">Modern Sans</div>
          <div class="setting-pill" data-val="serif" onclick="updateSetting('font', 'serif')">Academic Serif</div>
          <div class="setting-pill" data-val="mono" onclick="updateSetting('font', 'mono')">Tech Mono</div>
          <div class="setting-pill" data-val="tech" onclick="updateSetting('font', 'tech')">Space Tech</div>
          <div class="setting-pill" data-val="lobster" onclick="updateSetting('font', 'lobster')">Lobster Fun</div>
          <div class="setting-pill" data-val="georgia" onclick="updateSetting('font', 'georgia')">Classic Georgia</div>
          <div class="setting-pill" data-val="courier" onclick="updateSetting('font', 'courier')">Typewriter</div>
          <div class="setting-pill" data-val="pacifico" onclick="updateSetting('font', 'pacifico')">Pacifico Script</div>
          <div class="setting-pill" data-val="comic" onclick="updateSetting('font', 'comic')">Comic Sans</div>
          <div class="setting-pill" data-val="bangers" onclick="updateSetting('font', 'bangers')">Bangers Bold</div>
          <div class="setting-pill" data-val="retro" onclick="updateSetting('font', 'retro')">Retro Pixel</div>
          <div class="setting-pill" data-val="dancing" onclick="updateSetting('font', 'dancing')">Dancing Script</div>
          <div class="setting-pill" data-val="indie" onclick="updateSetting('font', 'indie')">Indie Hand</div>
          <div class="setting-pill" data-val="shadows" onclick="updateSetting('font', 'shadows')">Shadows Light</div>
          <div class="setting-pill" data-val="amatic" onclick="updateSetting('font', 'amatic')">Amatic SC</div>
          <div class="setting-pill" data-val="glitch" onclick="updateSetting('font', 'glitch')">Glitch Text</div>
          <div class="setting-pill" data-val="wetpaint" onclick="updateSetting('font', 'wetpaint')">Wet Paint</div>
          <div class="setting-pill" data-val="maze" onclick="updateSetting('font', 'maze')">Maze Font</div>
          <div class="setting-pill" data-val="bubbles" onclick="updateSetting('font', 'bubbles')">Bubble Fun</div>
          <div class="setting-pill" data-val="monoton" onclick="updateSetting('font', 'monoton')">Monoton Retro</div>
          <div class="setting-pill" data-val="fredericka" onclick="updateSetting('font', 'fredericka')">Fredericka</div>
          <div class="setting-pill" data-val="righteous" onclick="updateSetting('font', 'righteous')">Righteous</div>
          <div class="setting-pill" data-val="blackops" onclick="updateSetting('font', 'blackops')">Black Ops</div>
          <div class="setting-pill" data-val="orbitron" onclick="updateSetting('font', 'orbitron')">Orbitron Futura</div>
          <div class="setting-pill" data-val="rajdhani" onclick="updateSetting('font', 'rajdhani')">Rajdhani Tech</div>
          <div class="setting-pill" data-val="audiowide" onclick="updateSetting('font', 'audiowide')">Audiowide</div>
          <div class="setting-pill" data-val="kdam" onclick="updateSetting('font', 'kdam')">Kdam Thmor</div>
          <div class="setting-pill" data-val="smokum" onclick="updateSetting('font', 'smokum')">Smokum Western</div>
          <div class="setting-pill" data-val="stalinist" onclick="updateSetting('font', 'stalinist')">Stalinist One</div>
          <div class="setting-pill" data-val="tradewinds" onclick="updateSetting('font', 'tradewinds')">Trade Winds</div>
          <div class="setting-pill" data-val="unifraktur" onclick="updateSetting('font', 'unifraktur')">Medieval</div>
          <div class="setting-pill" data-val="vt323" onclick="updateSetting('font', 'vt323')">VT323 Terminal</div>
        </div>
      </div>
      <div class="settings-group">
        <span class="settings-label">App Theme</span>
        <div class="toggle-row" id="theme-options">
          <div class="setting-pill" data-val="midnight" onclick="updateSetting('theme', 'midnight')">Midnight</div>
          <div class="setting-pill" data-val="ocean" onclick="updateSetting('theme', 'ocean')">Ocean</div>
          <div class="setting-pill" data-val="citrus" onclick="updateSetting('theme', 'citrus')">Citrus Grove</div>
          <div class="setting-pill" data-val="sunset" onclick="updateSetting('theme', 'sunset')">Sunset</div>
          <div class="setting-pill" data-val="rose" onclick="updateSetting('theme', 'rose')">Rose</div>
          <div class="setting-pill" data-val="purple" onclick="updateSetting('theme', 'purple')">Purple</div>
          <div class="setting-pill" data-val="cyber" onclick="updateSetting('theme', 'cyber')">Cyber</div>
          <div class="setting-pill" data-val="custom" onclick="showThemeBuilder()">Custom Theme</div>
        </div>
      </div>
      
      <!-- Custom Theme Builder (hidden by default) -->
      <div class="settings-group theme-builder-container" id="theme-builder" style="display: none;">
        <span class="settings-label">Custom Theme Builder</span>
        <div class="theme-builder">
          <div class="color-input-group">
            <div class="color-input">
              <label>Primary:</label>
              <input type="color" id="custom-primary-color" value="#3b82f6">
              <input type="text" id="custom-primary-text" value="#3b82f6" placeholder="#3b82f6">
            </div>
            <div class="color-input">
              <label>Secondary:</label>
              <input type="color" id="custom-secondary-color" value="#8b5cf6">
              <input type="text" id="custom-secondary-text" value="#8b5cf6" placeholder="#8b5cf6">
            </div>
            <div class="color-input">
              <label>Background:</label>
              <input type="color" id="custom-bg-color" value="#020617">
              <input type="text" id="custom-bg-text" value="#020617" placeholder="#020617">
            </div>
          </div>
          <div class="color-preview">
            <div class="preview-color" id="preview-primary" style="background-color: #3b82f6;"></div>
            <div class="preview-color" id="preview-secondary" style="background-color: #8b5cf6;"></div>
            <div class="preview-color" id="preview-bg" style="background-color: #020617;"></div>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="save-btn" style="flex: 1;" onclick="saveCustomTheme()">Save Custom Theme</button>
            <button class="save-btn" style="flex: 1; background: var(--text-muted);" onclick="hideThemeBuilder()">Cancel</button>
          </div>
        </div>
      </div>
      
      <div class="settings-group">
        <span class="settings-label">Add New Bookmark</span>
        <div class="add-bookmark-form">
          <input type="text" id="bm-name" class="input-field" placeholder="Site Name">
          <input type="text" id="bm-url" class="input-field" placeholder="URL">
          <button class="save-btn" onclick="addCustomBookmark()">Add to List</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="bottom-bar">
  <div class="pill-info">IP: <span id="ip-addr">Detecting...</span></div>
  <div class="pill-info">Visits: <span id="visit-count">...</span></div>
</div>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
// Fixed Schedule based on PDF - Updated with requested changes
const SCHEDULE = {
  "Week A": {
    "Monday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:55" },
        { name: "Period 2", time: "9:00-10:00" },
        { name: "Period 3", time: "10:05-11:00" }
      ],
      "lunch": {
        "1": { 
          period4: "11:45-12:40",
          lunch: "11:00-11:40"
        },
        "2": { period4: ["11:05-11:32", "12:12-12:40"], lunch: "11:32-12:12" },
        "3": { period4: "11:05-12:00", lunch: "12:00-12:40" }
      },
      "period5": "12:45-1:40",
      "period6": "1:45-2:40",
      "anchors": []
    },
    "Tuesday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Anchor Time", time: "8:50-9:20" },
        { name: "Period 2", time: "9:25-10:20" },
        { name: "Period 3", time: "10:25-11:15" }
      ],
      "lunch": {
        "1": { 
          period4: "12:00-12:50",
          lunch: "11:15-11:55"
        },
        "2": { period4: ["11:20-11:45", "12:25-12:50"], lunch: "11:45-12:25" },
        "3": { period4: "11:20-12:10", lunch: "12:10-12:50" }
      },
      "period5": "12:55-1:45",
      "period6": "1:50-2:40",
      "anchors": []
    },
    "Wednesday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Period 2", time: "8:55-9:50" },
        { name: "Period 3", time: "9:55-10:45" },
        { name: "Anchor Time", time: "10:45-11:15" }
      ],
      "lunch": {
        // UPDATED: Week A Wednesday lunch 4c - Changed lunch to 11:15-11:55 and period 4 to 12:00-12:50
        "1": { 
          period4: "12:00-12:50",  // UPDATED: Changed from 11:30-12:20 to 12:00-12:50
          lunch: "11:15-11:55"     // UPDATED: Changed from 10:45-11:25 to 11:15-11:55
        },
        "2": { period4: ["11:20-11:45", "12:25-12:50"], lunch: "11:45-12:25" },
        "3": { period4: "11:20-12:10", lunch: "12:10-12:50" }
      },
      "period5": "12:55-1:45",
      "period6": "1:50-2:40",
      "anchors": []
    },
    "Thursday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Period 2", time: "8:55-9:50" },
        { name: "Period 3", time: "9:55-10:45" }
      ],
      "lunch": {
        "1": { 
          period4: "11:30-12:20", 
          lunch: "10:45-11:25"
        },
        "2": { period4: ["10:50-11:15", "11:55-12:20"], lunch: "11:15-11:55" },
        "3": { period4: "10:50-11:40", lunch: "11:40-12:20" }
      },
      "period5": "12:25-1:15",
      "period6": "1:50-2:40",
      "anchors": ["1:15-1:45"]
    },
    "Friday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:55" },
        { name: "Period 2", time: "9:00-10:00" },
        { name: "Period 3", time: "10:05-11:00" }
      ],
      "lunch": {
        "1": { 
          period4: "11:45-12:40",
          lunch: "11:00-11:40"
        },
        "2": { period4: ["11:05-11:32", "12:12-12:40"], lunch: "11:32-12:12" },
        "3": { period4: "11:05-12:00", lunch: "12:00-12:40" }
      },
      "period5": "12:45-1:40",
      "period6": "1:45-2:40",
      "anchors": []
    }
  },
  "Week B": {
    "Monday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:55" },
        { name: "Period 2", time: "9:00-10:00" },
        { name: "Period 3", time: "10:05-11:00" }
      ],
      "lunch": {
        // UPDATED: Week B Monday lunch 4c - Changed lunch to 11:00-11:40 and period 4 to 11:45-12:40
        "1": { 
          period4: "11:45-12:40",  // UPDATED: Changed from 11:30-12:20 to 11:45-12:40
          lunch: "11:00-11:40"     // UPDATED: Changed from 10:45-11:25 to 11:00-11:40
        },
        "2": { period4: ["11:05-11:32", "12:12-12:40"], lunch: "11:32-12:12" },
        "3": { period4: "11:05-12:00", lunch: "12:00-12:40" }
      },
      "period5": "12:45-1:40",
      "period6": "1:45-2:40",
      "anchors": []
    },
    "Tuesday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Period 2", time: "8:55-9:50" },
        { name: "Anchor Time", time: "9:50-10:20" },
        { name: "Period 3", time: "10:25-11:15" }
      ],
      "lunch": {
        // UPDATED: Week B Tuesday lunch 4c - Changed lunch to 11:15-11:55 and period 4 to 12:00-12:50
        "1": { 
          period4: "12:00-12:50",  // UPDATED: Changed from 11:30-12:20 to 12:00-12:50
          lunch: "11:15-11:55"     // UPDATED: Changed from 10:45-11:25 to 11:15-11:55
        },
        "2": { period4: ["11:20-11:45", "12:25-12:50"], lunch: "11:45-12:25" },
        "3": { period4: "11:20-12:10", lunch: "12:10-12:50" }
      },
      "period5": "12:55-1:45",
      "period6": "1:50-2:40",
      "anchors": []
    },
    "Wednesday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Period 2", time: "8:55-9:50" },
        { name: "Period 3", time: "9:55-10:45" }
      ],
      "lunch": {
        "1": { 
          period4: "11:30-12:20", 
          lunch: "10:45-11:25"
        },
        "2": { 
          period4: ["10:50-11:15", "11:55-12:20"], 
          lunch: "11:15-11:55"
        },
        "3": { 
          period4: "10:50-11:40", 
          lunch: "11:40-12:20"
        }
      },
      "period5": "12:55-1:45",
      "period6": "1:50-2:40",
      "anchors": ["12:20-12:50"]
    },
    "Thursday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:50" },
        { name: "Period 2", time: "8:55-9:50" },
        { name: "Period 3", time: "9:55-10:45" }
      ],
      "lunch": {
        "1": { 
          period4: "11:30-12:20", 
          lunch: "10:45-11:25"
        },
        "2": { period4: ["10:50-11:15", "11:55-12:20"], lunch: "11:15-11:55" },
        "3": { period4: "10:50-11:40", lunch: "11:40-12:20" }
      },
      "period5": "12:25-1:15",
      "period6": "1:20-2:10",
      "anchors": ["2:10-2:40"]
    },
    "Friday": {
      "periods": [
        { name: "Period 1", time: "8:00-8:55" },
        { name: "Period 2", time: "9:00-10:00" },
        { name: "Period 3", time: "10:05-11:00" }
      ],
      "lunch": {
        "1": { 
          period4: "11:45-12:40",
          lunch: "11:00-11:40"
        },
        "2": { period4: ["11:05-11:32", "12:12-12:40"], lunch: "11:32-12:12" },
        "3": { period4: "11:05-12:00", lunch: "12:00-12:40" }
      },
      "period5": "12:45-1:40",
      "period6": "1:45é—®å·è°ƒæŸ¥è°ƒæŸ¥é—®å·-2:40",
      "anchors": []
    }
  }
};

// State
let selectedLunch = localStorage.getItem('mhs_lunch_choice') || "3";
let currentFont = localStorage.getItem('mhs_font') || 'sans';
let currentTheme = localStorage.getItem('mhs_theme') || 'midnight';
let currentMode = localStorage.getItem('mhs_mode') || 'standard';
let celebrationEnabled = localStorage.getItem('mhs_celebration') !== 'off';
let timeFormat = localStorage.getItem('mhs_timeformat') || '12hr';
let motionSetting = localStorage.getItem('mhs_motion') || 'normal';
let backgroundEffect = localStorage.getItem('mhs_background_effect') || 'none';
let customBookmarks = JSON.parse(localStorage.getItem('mhs_custom_bookmarks')) || [
  { name: "Gemini AI", url: "https://gemini.google.com/app" },
  { name: "Schoology", url: "https://minnetonka.schoology.com" },
  { name: "Gmail", url: "https://mail.google.com" }
];
let lastCelebratedPeriodId = ""; 
let viewingDate = new Date();

// Custom theme variables
let customPrimary = localStorage.getItem('mhs_custom_primary') || '#3b82f6';
let customSecondary = localStorage.getItem('mhs_custom_secondary') || '#8b5cf6';
let customBg = localStorage.getItem('mhs_custom_bg') || '#020617';

// Particle System Variables
let particles = [];
let particleCanvas, particleCtx;
let animationId = null;
let lastTime = 0;

// Bubbles system
let bubbles = [];
let bubblesContainer;

// DVD bouncing system
let dvdContainer;
let dvdLogos = [];

// Rain system
let rainContainer;
let raindrops = [];

// Scroll detection
let lastScrollTop = 0;
let creatorBarTimeout = null;

// Timer last minute state
let isLastMinute = false;

// Loading screen timeout
let loadingTimeout = null;

// Initialize EmailJS once (with your public key)
(function() {
  emailjs.init({
    publicKey: "H1Q7r_KdpW6yYyqn3",
  });
})();

// Function to send the visitor notification (with daily limit)
async function notifyMeAboutNewVisitor() {
  // Simple anti-spam: only send once per day per browser
  const lastSent = localStorage.getItem('lastVisitorNotify');
  const now = Date.now();
  const oneDayMs = 24 * 60 * 60 * 1000; // 24 hours

  if (lastSent && now - Number(lastSent) < oneDayMs) {
    console.log("Already sent visitor notification today â†’ skipping");
    return;
  }

  try {
    // Get visitor's IP (you already use this API in your code)
    const ipResponse = await fetch('https://api.ipify.org?format=json');
    const ipData = await ipResponse.json();
    const visitorIP = ipData.ip || 'unknown';

    // Visitor's local time (readable format)
    const visitTime = new Date().toLocaleString('en-US', {
      timeZoneName: 'short',
      weekday: 'short',
      month: 'short',
      day: 'numeric',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    });

    // Data to send in the email
    const templateParams = {
      visit_time: visitTime,
      visitor_ip: visitorIP,
      page: window.location.href,
      user_agent: navigator.userAgent,
    };

    // Send using your IDs
    const response = await emailjs.send(
      'service_17usvk3',     // Service ID
      'template_d7z6mac',    // Template ID
      templateParams
    );

    console.log('Visitor notification sent!', response.status, response.text);

    // Mark as sent today
    localStorage.setItem('lastVisitorNotify', now.toString());
  } catch (error) {
    console.error('Failed to send visitor notification:', error);
  }
}

// Run after page load (small delay so the page feels fast)
window.addEventListener('load', () => {
  setTimeout(notifyMeAboutNewVisitor, 1200);
});

// Initialize loading screen
function initLoadingScreen() {
  const loadingScreen = document.getElementById('loading-screen');
  
  // Ensure fonts are loaded before hiding loading screen
  document.fonts.ready.then(() => {
    // Wait 1 second after page load (as requested)
    loadingTimeout = setTimeout(() => {
      loadingScreen.classList.add('fade-out');
      
      // Remove loading screen after fade out
      setTimeout(() => {
        loadingScreen.style.display = 'none';
      }, 500);
    }, 1000); // 1 second delay
  });
}

// Enhanced DVD Bouncing Effect with unpredictable movement
function initDvdEffect() {
  dvdContainer = document.getElementById('dvd-bg');
  dvdContainer.innerHTML = '';
  dvdLogos = [];
  
  // Create many more DVD logos for a crowded effect
  const logoCount = motionSetting === 'reduced' ? 8 : 15; // More logos
  
  for (let i = 0; i < logoCount; i++) {
    const logo = document.createElement('div');
    logo.className = 'dvd-logo';
    logo.textContent = 'DVD';
    
    // Random size for variety
    const size = Math.random() * 30 + 50; // 50-80px width
    logo.style.width = `${size}px`;
    logo.style.height = `${size * 0.5}px`;
    
    // Random starting position
    logo.style.left = `${Math.random() * 90}%`;
    logo.style.top = `${Math.random() * 90}%`;
    
    // Different colors for each logo
    const hue = Math.floor(Math.random() * 360);
    logo.style.background = `linear-gradient(45deg, hsl(${hue}, 70%, 60%), hsl(${hue + 30}, 70%, 60%))`;
    
    // Unpredictable bouncing with random animation
    const duration = Math.random() * 15 + 10; // 10-25 seconds
    const delay = Math.random() * 5; // 0-5 seconds delay
    
    // Create a unique unpredictable animation
    const keyframesName = `dvdMoveUnpredictable${i}`;
    createUnpredictableAnimation(keyframesName);
    
    logo.style.animation = `${keyframesName} ${duration}s linear infinite ${delay}s`;
    logo.style.opacity = `${0.1 + Math.random() * 0.15}`; // Slightly different opacity
    
    dvdContainer.appendChild(logo);
    dvdLogos.push(logo);
  }
}

// Create unpredictable animation keyframes
function createUnpredictableAnimation(name) {
  const styleSheet = document.styleSheets[0];
  const keyframes = `
    @keyframes ${name} {
      0% {
        transform: translate(0, 0);
      }
      10% {
        transform: translate(${Math.random() * 80 - 40}vw, ${Math.random() * 40 - 20}vh);
      }
      30% {
        transform: translate(${Math.random() * 80 - 40}vw, ${Math.random() * 60 - 30}vh);
      }
      50% {
        transform: translate(${Math.random() * 100 - 50}vw, ${Math.random() * 80 - 40}vh);
      }
      70% {
        transform: translate(${Math.random() * 60 - 30}vw, ${Math.random() * 100 - 50}vh);
      }
      90% {
        transform: translate(${Math.random() * 40 - 20}vw, ${Math.random() * 60 - 30}vh);
      }
      100% {
        transform: translate(0, 0);
      }
    }
  `;
  
  styleSheet.insertRule(keyframes, styleSheet.cssRules.length);
}

// Rain Background Effect
function initRainEffect() {
  rainContainer = document.getElementById('rain-bg');
  rainContainer.innerHTML = '';
  raindrops = [];
  
  // Create many raindrops for a dense rain effect
  const dropCount = motionSetting === 'reduced' ? 50 : 120;
  
  for (let i = 0; i < dropCount; i++) {
    const raindrop = document.createElement('div');
    raindrop.className = 'raindrop';
    
    // Random position
    raindrop.style.left = `${Math.random() * 100}%`;
    
    // Random animation properties for natural rain
    const duration = Math.random() * 1.5 + 1; // 1-2.5 seconds
    const delay = Math.random() * 2; // 0-2 seconds delay
    const opacity = Math.random() * 0.5 + 0.3; // 0.3-0.8 opacity
    
    raindrop.style.animationDuration = `${duration}s`;
    raindrop.style.animationDelay = `${delay}s`;
    raindrop.style.opacity = `${opacity}`;
    
    // Random raindrop length
    const length = Math.random() * 15 + 10; // 10-25px
    raindrop.style.height = `${length}px`;
    
    // Random width
    const width = Math.random() * 1 + 1; // 1-2px
    raindrop.style.width = `${width}px`;
    
    // Color based on theme
    const hue = Math.floor(Math.random() * 60) + 180; // Blueish tones
    raindrop.style.background = `linear-gradient(to bottom, transparent, hsl(${hue}, 70%, 60%))`;
    
    rainContainer.appendChild(raindrop);
    raindrops.push(raindrop);
  }
}

// Timer last minute effect
function updateTimerEffects(currentTime, active) {
  const timerElement = document.getElementById('timer');
  const timerWrapper = document.getElementById('timer-wrapper');
  const currentPeriodElement = document.getElementById('current-period');
  
  if (active && active.end) {
    const timeRemaining = active.end - currentTime;
    const isLastMinuteNow = timeRemaining <= 1 && timeRemaining > 0; // Less than 1 minute remaining
    
    if (isLastMinuteNow && !isLastMinute) {
      // Entering last minute
      isLastMinute = true;
      timerElement.style.color = '#ef4444'; // Red color
      currentPeriodElement.style.color = '#ef4444';
      timerWrapper.classList.add('timer-pulse');
      
      // Also update progress bar color
      document.getElementById('progress-bar').style.stroke = '#ef4444';
    } else if (!isLastMinuteNow && isLastMinute) {
      // Exiting last minute
      isLastMinute = false;
      timerElement.style.color = ''; // Reset to default
      currentPeriodElement.style.color = '';
      timerWrapper.classList.remove('timer-pulse');
      
      // Reset progress bar color
      document.getElementById('progress-bar').style.stroke = 'url(#grad)';
    }
  } else if (isLastMinute) {
    // Reset if no active period
    isLastMinute = false;
    timerElement.style.color = '';
    currentPeriodElement.style.color = '';
    timerWrapper.classList.remove('timer-pulse');
    document.getElementById('progress-bar').style.stroke = 'url(#grad)';
  }
}

// Save to Home Notification
function showSaveToHomeNotification() {
  const hasDismissed = localStorage.getItem('mhs_save_notification_dismissed');
  const dismissalDate = localStorage.getItem('mhs_save_notification_dismissal_date');
  
  if (hasDismissed === 'permanent') return;
  
  if (hasDismissed === 'temporary') {
    const now = new Date();
    const dismissalTime = new Date(dismissalDate);
    const daysSinceDismissal = (now - dismissalTime) / (1000 * 60 * 60 * 24);
    if (daysSinceDismissal < 7) return;
  }
  
  setTimeout(() => {
    const notification = document.getElementById('save-to-home-notification');
    notification.classList.add('show');
  }, 1500);
}

function dismissSaveNotification(permanent) {
  const notification = document.getElementById('save-to-home-notification');
  notification.classList.remove('show');
  
  if (permanent) {
    localStorage.setItem('mhs_save_notification_dismissed', 'permanent');
  } else {
    localStorage.setItem('mhs_save_notification_dismissed', 'temporary');
    localStorage.setItem('mhs_save_notification_dismissal_date', new Date().toISOString());
  }
}

// Handle scroll
function handleScroll() {
  const creatorBar = document.querySelector('.creator-credit-bar');
  if (!creatorBar) return;
  
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  const windowHeight = window.innerHeight;
  const documentHeight = document.documentElement.scrollHeight;
  
  if (scrollTop + windowHeight >= documentHeight - 100) {
    creatorBar.classList.add('visible');
    clearTimeout(creatorBarTimeout);
    
    creatorBarTimeout = setTimeout(() => {
      if (scrollTop + windowHeight < documentHeight - 50) {
        creatorBar.classList.remove('visible');
      }
    }, 5000);
  } else {
    creatorBar.classList.remove('visible');
  }
  
  lastScrollTop = scrollTop;
}

// Particle System
function initParticles() {
  particleCanvas = document.getElementById('particles-canvas');
  particleCtx = particleCanvas.getContext('2d');
  
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  
  createParticles();
  animateParticles();
}

function resizeCanvas() {
  particleCanvas.width = window.innerWidth;
  particleCanvas.height = window.innerHeight;
}

function createParticles() {
  particles = [];
  const particleCount = motionSetting === 'reduced' ? 20 : 50;
  
  for (let i = 0; i < particleCount; i++) {
    particles.push({
      x: Math.random() * particleCanvas.width,
      y: Math.random() * particleCanvas.height,
      size: Math.random() * 3 + 1,
      speedX: (Math.random() - 0.5) * (motionSetting === 'reduced' ? 0.2 : 0.5),
      speedY: (Math.random() - 0.5) * (motionSetting === 'reduced' ? 0.2 : 0.5),
      color: `rgba(${Math.floor(Math.random() * 100 + 155)}, ${Math.floor(Math.random() * 100 + 155)}, 255, ${Math.random() * 0.3 + 0.1})`
    });
  }
}

function animateParticles(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const deltaTime = timestamp - lastTime;
  lastTime = timestamp;
  
  particleCtx.fillStyle = 'rgba(2, 6, 23, 0.05)';
  particleCtx.fillRect(0, 0, particleCanvas.width, particleCanvas.height);
  
  particles.forEach(particle => {
    particle.x += particle.speedX * (motionSetting === 'reduced' ? 0.3 : 1);
    particle.y += particle.speedY * (motionSetting === 'reduced' ? 0.3 : 1);
    
    if (particle.x < 0) particle.x = particleCanvas.width;
    if (particle.x > particleCanvas.width) particle.x = 0;
    if (particle.y < 0) particle.y = particleCanvas.height;
    if (particle.y > particleCanvas.height) particle.y = 0;
    
    particleCtx.beginPath();
    particleCtx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
    particleCtx.fillStyle = particle.color;
    particleCtx.fill();
    
    particles.forEach(otherParticle => {
      const dx = particle.x - otherParticle.x;
      const dy = particle.y - otherParticle.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      
      if (distance < 100) {
        particleCtx.beginPath();
        particleCtx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - distance/100)})`;
        particleCtx.lineWidth = 0.5;
        particleCtx.moveTo(particle.x, particle.y);
        particleCtx.lineTo(otherParticle.x, otherParticle.y);
        particleCtx.stroke();
      }
    });
  });
  
  animationId = requestAnimationFrame(animateParticles);
}

function stopParticles() {
  if (animationId) {
    cancelAnimationFrame(animationId);
    animationId = null;
  }
}

// Initialize bubbles
function initBubbles() {
  bubblesContainer = document.getElementById('bubbles-bg');
  bubblesContainer.innerHTML = '';
  bubbles = [];
  
  const bubbleCount = motionSetting === 'reduced' ? 15 : 30;
  
  for (let i = 0; i < bubbleCount; i++) {
    const size = Math.random() * 60 + 20;
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.style.width = `${size}px`;
    bubble.style.height = `${size}px`;
    bubble.style.left = `${Math.random() * 100}%`;
    bubble.style.top = `${Math.random() * 100}%`;
    bubble.style.background = `rgba(${Math.floor(Math.random() * 100 + 155)}, ${Math.floor(Math.random() * 100 + 155)}, 255, ${Math.random() * 0.1 + 0.05})`;
    bubble.style.animationDuration = `${Math.random() * 5 + 8}s`;
    bubble.style.animationDelay = `${Math.random() * 3}s`;
    
    bubblesContainer.appendChild(bubble);
    bubbles.push(bubble);
  }
}

// Apply background effect
function applyBackgroundEffect() {
  document.body.classList.remove('background-effect-particles', 'background-effect-gradient', 'background-effect-bubbles', 'background-effect-grid', 'background-effect-dvd', 'background-effect-rain', 'background-effect-none');
  document.body.classList.add(`background-effect-${backgroundEffect}`);
  
  if (backgroundEffect === 'particles') {
    if (!animationId) {
      initParticles();
    }
    if (bubblesContainer) {
      bubblesContainer.innerHTML = '';
    }
    if (dvdContainer) {
      dvdContainer.innerHTML = '';
      dvdLogos = [];
    }
    if (rainContainer) {
      rainContainer.innerHTML = '';
      raindrops = [];
    }
  } else if (backgroundEffect === 'bubbles') {
    stopParticles();
    initBubbles();
    if (dvdContainer) {
      dvdContainer.innerHTML = '';
      dvdLogos = [];
    }
    if (rainContainer) {
      rainContainer.innerHTML = '';
      raindrops = [];
    }
  } else if (backgroundEffect === 'dvd') {
    stopParticles();
    if (bubblesContainer) {
      bubblesContainer.innerHTML = '';
    }
    if (rainContainer) {
      rainContainer.innerHTML = '';
      raindrops = [];
    }
    initDvdEffect();
  } else if (backgroundEffect === 'rain') {
    stopParticles();
    if (bubblesContainer) {
      bubblesContainer.innerHTML = '';
    }
    if (dvdContainer) {
      dvdContainer.innerHTML = '';
      dvdLogos = [];
    }
    initRainEffect();
  } else {
    stopParticles();
    if (bubblesContainer) {
      bubblesContainer.innerHTML = '';
    }
    if (dvdContainer) {
      dvdContainer.innerHTML = '';
      dvdLogos = [];
    }
    if (rainContainer) {
      rainContainer.innerHTML = '';
      raindrops = [];
    }
  }
}

// Custom Theme Functions
function showThemeBuilder() {
  const themeBuilder = document.getElementById('theme-builder');
  themeBuilder.style.display = 'block';
  
  document.getElementById('custom-primary-color').value = customPrimary;
  document.getElementById('custom-primary-text').value = customPrimary;
  document.getElementById('custom-secondary-color').value = customSecondary;
  document.getElementById('custom-secondary-text').value = customSecondary;
  document.getElementById('custom-bg-color').value = customBg;
  document.getElementById('custom-bg-text').value = customBg;
  
  updateColorPreviews();
  
  themeBuilder.scrollIntoView({ behavior: 'smooth' });
}

function hideThemeBuilder() {
  document.getElementById('theme-builder').style.display = 'none';
}

function updateColorPreviews() {
  document.getElementById('preview-primary').style.backgroundColor = customPrimary;
  document.getElementById('preview-secondary').style.backgroundColor = customSecondary;
  document.getElementById('preview-bg').style.backgroundColor = customBg;
}

function saveCustomTheme() {
  customPrimary = document.getElementById('custom-primary-text').value;
  customSecondary = document.getElementById('custom-secondary-text').value;
  customBg = document.getElementById('custom-bg-text').value;
  
  if (!customPrimary.startsWith('#')) customPrimary = '#3b82f6';
  if (!customSecondary.startsWith('#')) customSecondary = '#8b5cf6';
  if (!customBg.startsWith('#')) customBg = '#020617';
  
  localStorage.setItem('mhs_custom_primary', customPrimary);
  localStorage.setItem('mhs_custom_secondary', customSecondary);
  localStorage.setItem('mhs_custom_bg', customBg);
  
  updateSetting('theme', 'custom');
  
  hideThemeBuilder();
  
  const toast = document.getElementById('toast-notification');
  toast.textContent = "ðŸŽ¨ Custom Theme Saved!";
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Color input sync
function setupColorInputs() {
  const colorInputs = [
    { color: 'custom-primary-color', text: 'custom-primary-text' },
    { color: 'custom-secondary-color', text: 'custom-secondary-text' },
    { color: 'custom-bg-color', text: 'custom-bg-text' }
  ];
  
  colorInputs.forEach(input => {
    const colorEl = document.getElementById(input.color);
    const textEl = document.getElementById(input.text);
    
    colorEl.addEventListener('input', () => {
      textEl.value = colorEl.value;
      updateColorPreviews();
    });
    
    textEl.addEventListener('input', () => {
      const color = textEl.value;
      if (color.match(/^#[0-9A-F]{6}$/i)) {
        colorEl.value = color;
        updateColorPreviews();
      }
    });
    
    textEl.addEventListener('change', () => {
      const color = textEl.value;
      if (!color.startsWith('#')) {
        textEl.value = '#' + color.replace(/^#/, '');
      }
    });
  });
}

// Dropdown functions
function toggleDropdown(id) {
  const el = document.getElementById(id);
  const isOpen = el.classList.contains('open');
  const isClosing = el.classList.contains('closing');
  
  if (isClosing) return;
  
  document.querySelectorAll('.dropdown').forEach(d => {
    if (d !== el && d.classList.contains('open')) {
      closeDropdownWithTransition(d);
    }
  });
  
  if (!isOpen) {
    el.classList.add('open');
    if (id === 'settings-dropdown') {
      document.body.classList.add('settings-open');
    }
  } else {
    closeDropdownWithTransition(el);
    if (id === 'settings-dropdown') {
      document.body.classList.remove('settings-open');
    }
  }
}

function closeDropdownWithTransition(dropdown) {
  if (!dropdown.classList.contains('open')) return;
  
  dropdown.classList.add('closing');
  dropdown.classList.remove('open');
  
  setTimeout(() => {
    dropdown.classList.remove('closing');
    if (dropdown.id === 'settings-dropdown') {
      document.body.classList.remove('settings-open');
    }
  }, 300);
}

function closeAllDropdowns() {
  document.querySelectorAll('.dropdown.open').forEach(dropdown => {
    closeDropdownWithTransition(dropdown);
  });
  document.body.classList.remove('settings-open');
}

// Event listeners
document.addEventListener('click', function(event) {
  const dropdowns = document.querySelectorAll('.dropdown');
  let isDropdownClick = false;
  
  dropdowns.forEach(dropdown => {
    if (dropdown.contains(event.target)) {
      isDropdownClick = true;
    }
  });
  
  if (!isDropdownClick) {
    closeAllDropdowns();
  }
});

function formatMinToTime(min) {
  let h = Math.floor(min / 60), m = min % 60;
  
  if (timeFormat === '24hr') {
    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
  } else {
    let ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12 || 12;
    return `${h}:${m.toString().padStart(2, '0')} ${ampm}`;
  }
}

// Updated: Function to format date and time with seconds
function formatDateTimeWithSeconds(date) {
  const now = new Date();
  const isToday = now.toDateString() === viewingDate.toDateString();
  const displayDate = isToday ? now : viewingDate;
  
  const month = displayDate.toLocaleString('en-US', { month: 'long' });
  const day = displayDate.getDate();
  const year = displayDate.getFullYear();
  const dayName = displayDate.toLocaleString('en-US', { weekday: 'long' });
  
  if (timeFormat === '24hr') {
    const hours = displayDate.getHours().toString().padStart(2, '0');
    const minutes = displayDate.getMinutes().toString().padStart(2, '0');
    const seconds = displayDate.getSeconds().toString().padStart(2, '0');
    return `${month} ${day}, ${year} â€¢ ${hours}:${minutes}:${seconds}`;
  } else {
    let hours = displayDate.getHours();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    const minutes = displayDate.getMinutes().toString().padStart(2, '0');
    const seconds = displayDate.getSeconds().toString().padStart(2, '0');
    return `${month} ${day}, ${year} â€¢ ${hours}:${minutes}:${seconds} ${ampm}`;
  }
}

function formatDateDisplay(date) {
  return date.toLocaleDateString([], { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
}

// Updated: Update datetime bubble with full date and time including seconds
function updateDateTimeBubble() {
  const now = new Date();
  const isToday = now.toDateString() === viewingDate.toDateString();
  const dayElement = document.getElementById('current-day');
  const timeElement = document.getElementById('current-date-time-full');
  const indicatorElement = document.getElementById('selected-day-indicator');
  
  if (dayElement && timeElement && indicatorElement) {
    if (isToday) {
      // Show current day and full date/time with seconds
      dayElement.textContent = now.toLocaleDateString([], { weekday: 'long' });
      timeElement.textContent = formatDateTimeWithSeconds(now);
      indicatorElement.textContent = '';
    } else {
      // Show selected day and date
      const selectedDayName = viewingDate.toLocaleString('en-US', { weekday: 'long' });
      const month = viewingDate.toLocaleString('en-US', { month: 'long' });
      const day = viewingDate.getDate();
      const year = viewingDate.getFullYear();
      
      dayElement.textContent = selectedDayName;
      timeElement.textContent = `${month} ${day}, ${year}`;
      indicatorElement.textContent = `Viewing: ${selectedDayName}`;
    }
  }
}

// Update selected day indicator
function updateSelectedDayIndicator() {
  const now = new Date();
  const isToday = now.toDateString() === viewingDate.toDateString();
  const dayName = viewingDate.toLocaleString('en-US', { weekday: 'long' });
  const indicatorElement = document.getElementById('selected-day-indicator');
  const dayElement = document.getElementById('current-day');
  const timeElement = document.getElementById('current-date-time-full');
  
  if (!isToday) {
    if (dayElement) dayElement.textContent = dayName;
    if (timeElement) {
      const month = viewingDate.toLocaleString('en-US', { month: 'long' });
      const day = viewingDate.getDate();
      const year = viewingDate.getFullYear();
      timeElement.textContent = `${month} ${day}, ${year}`;
    }
    if (indicatorElement) {
      indicatorElement.textContent = `Viewing: ${dayName}`;
    }
  } else {
    if (indicatorElement) indicatorElement.textContent = '';
    updateDateTimeBubble();
  }
}

// New function: Smooth transition when switching days
function animateDaySwitch() {
  const scheduleCard = document.getElementById('schedule-card');
  const lunchSelector = document.getElementById('lunch-selector');
  
  if (scheduleCard && lunchSelector) {
    // Add fade-out class
    scheduleCard.classList.add('fade-out');
    lunchSelector.classList.add('fade-out');
    
    // After fade out, update content, then fade in
    setTimeout(() => {
      // Remove fade-out class to trigger fade-in
      scheduleCard.classList.remove('fade-out');
      lunchSelector.classList.remove('fade-out');
    }, 400); // Match the transition duration
  }
}

// Updated: Change date function with smooth transition
function changeDate(days) {
  animateDaySwitch();
  
  // Wait a bit for animation to start, then change date
  setTimeout(() => {
    viewingDate.setDate(viewingDate.getDate() + days);
    update();
    updateSelectedDayIndicator();
  }, 100);
}

function goToToday() {
  animateDaySwitch();
  
  setTimeout(() => {
    viewingDate = new Date();
    update();
    updateSelectedDayIndicator();
  }, 100);
}

// Init UI
document.addEventListener('DOMContentLoaded', function() {
  // Initialize loading screen
  initLoadingScreen();
  
  document.querySelector(`input[value="${selectedLunch}"]`).checked = true;
  updateSetting('font', currentFont);
  updateSetting('theme', currentTheme);
  updateSetting('mode', currentMode);
  updateSetting('celebration', celebrationEnabled ? 'on' : 'off');
  updateSetting('timeformat', timeFormat);
  updateSetting('motion', motionSetting);
  updateSetting('background-effect', backgroundEffect);
  
  renderBookmarks();
  getIPAddress();
  
  applyBackgroundEffect();
  
  setupColorInputs();
  
  showSaveToHomeNotification();
  
  window.addEventListener('scroll', handleScroll);
  
  // Update datetime bubble every second to show seconds
  updateDateTimeBubble();
  setInterval(updateDateTimeBubble, 1000);
  
  setTimeout(handleScroll, 100);
});

let visits = parseInt(localStorage.getItem('mhs_visit_count') || "0") + 1;
localStorage.setItem('mhs_visit_count', visits);
document.getElementById('visit-count').textContent = visits;

async function getIPAddress() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    document.getElementById('ip-addr').textContent = data.ip;
  } catch (e) { document.getElementById('ip-addr').textContent = '...'; }
}

function updateSetting(type, val) {
  if (type === 'font') { 
    currentFont = val; 
    localStorage.setItem('mhs_font', val); 
  }
  else if (type === 'theme') { 
    currentTheme = val; 
    localStorage.setItem('mhs_theme', val); 
  }
  else if (type === 'mode') { 
    currentMode = val; 
    localStorage.setItem('mhs_mode', val); 
    if (val === 'sign') {
      document.querySelector('.creator-credit-bar').style.display = 'none';
    } else {
      document.querySelector('.creator-credit-bar').style.display = 'flex';
    }
  }
  else if (type === 'celebration') { 
    celebrationEnabled = (val === 'on'); 
    localStorage.setItem('mhs_celebration', val); 
  }
  else if (type === 'timeformat') { 
    timeFormat = val; 
    localStorage.setItem('mhs_timeformat', val); 
  }
  else if (type === 'motion') { 
    motionSetting = val; 
    localStorage.setItem('mhs_motion', val);
    
    if (val === 'reduced') {
      document.body.classList.add('motion-reduced');
      if (backgroundEffect === 'particles' && particles.length > 0) {
        createParticles();
      }
      if (backgroundEffect === 'bubbles') {
        initBubbles();
      }
      if (backgroundEffect === 'dvd') {
        initDvdEffect();
      }
      if (backgroundEffect === 'rain') {
        initRainEffect();
      }
    } else {
      document.body.classList.remove('motion-reduced');
      if (backgroundEffect === 'particles' && particles.length > 0) {
        createParticles();
      }
      if (backgroundEffect === 'bubbles') {
        initBubbles();
      }
      if (backgroundEffect === 'dvd') {
        initDvdEffect();
      }
      if (backgroundEffect === 'rain') {
        initRainEffect();
      }
    }
  }
  else if (type === 'background-effect') {
    backgroundEffect = val;
    localStorage.setItem('mhs_background_effect', val);
    applyBackgroundEffect();
  }
  
  applyStyles();
  updatePillUI(`${type}-options`, val);
  if (type !== 'motion' && type !== 'background-effect') {
    update();
  }
}

function applyStyles() {
    document.body.className = `font-${currentFont} theme-${currentTheme} mode-${currentMode}`;
    if (motionSetting === 'reduced') {
      document.body.classList.add('motion-reduced');
    }
    
    if (currentTheme === 'custom') {
      document.documentElement.style.setProperty('--custom-primary', customPrimary);
      document.documentElement.style.setProperty('--custom-secondary', customSecondary);
      document.documentElement.style.setProperty('--custom-bg', customBg);
    }
    
    applyBackgroundEffect();
}

function updatePillUI(id, val) {
  document.querySelectorAll(`#${id} .setting-pill`).forEach(p => {
    p.classList.toggle('active', p.getAttribute('data-val') === val);
  });
}

function renderBookmarks() {
  const list = document.getElementById('bookmarks-list');
  list.innerHTML = customBookmarks.map((bm, i) => `
    <div class="bookmark-item">
      <a href="${bm.url}" target="_blank" class="bookmark-link">${bm.name}</a>
      <button class="delete-bm" onclick="deleteBookmark(${i})">âœ•</button>
    </div>
  `).join('');
}

function addCustomBookmark() {
  const name = document.getElementById('bm-name').value.trim();
  let url = document.getElementById('bm-url').value.trim();
  if (!name || !url) return;
  if (!url.startsWith('http')) url = 'https://' + url;
  customBookmarks.push({ name, url });
  localStorage.setItem('mhs_custom_bookmarks', JSON.stringify(customBookmarks));
  renderBookmarks();
  document.getElementById('bm-name').value = '';
  document.getElementById('bm-url').value = '';
}

function deleteBookmark(index) {
  customBookmarks.splice(index, 1);
  localStorage.setItem('mhs_custom_bookmarks', JSON.stringify(customBookmarks));
  renderBookmarks();
}

function parseTimeToMin(s) {
  if (!s) return null;
  const parts = s.split('-').map(t => {
    let [h, m] = t.trim().split(':').map(Number);
    if (h >= 1 && h <= 7) h += 12;
    return h * 60 + m;
  });
  return { start: parts[0], end: parts[1] };
}

function celebrate() {
  if (!celebrationEnabled) return;
  const toast = document.getElementById('toast-notification');
  toast.classList.add('show');
  confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#3b82f6', '#8b5cf6', '#ffffff'] });
  setTimeout(() => toast.classList.remove('show'), 6000);
}

function update() {
  const now = new Date();
  const isToday = now.toDateString() === viewingDate.toDateString();
  const dayName = viewingDate.toLocaleString('en-US', { weekday: 'long' });
  const weekRefDate = new Date(2025, 8, 1);
  const weekNum = Math.floor((viewingDate - weekRefDate) / (7 * 24 * 60 * 60 * 1000));
  const week = weekNum % 2 === 0 ? "Week A" : "Week B";
  const currentTime = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;

  document.getElementById('week-badge').textContent = week;
  
  const timerWrapper = document.getElementById('timer-wrapper');
  if (isToday) {
    timerWrapper.classList.remove('hidden');
    document.getElementById('viewing-indicator').classList.remove('visible');
  } else {
    timerWrapper.classList.add('hidden');
    document.getElementById('viewing-indicator').classList.add('visible');
  }

  const daySchedule = SCHEDULE[week][dayName];
  if (!daySchedule) {
    document.getElementById('current-period').textContent = "Weekend";
    document.getElementById('schedule-body').innerHTML = `<tr><td colspan="2" style="text-align:center; padding: 3rem; color: var(--text-muted);">No school scheduled for ${dayName}.</td></tr>`;
    return;
  }

  let timeline = [...daySchedule.periods];
  
  if (week === "Week B" && dayName === "Thursday") {
    const lunchData = daySchedule.lunch[selectedLunch];
    
    if (selectedLunch === "1") {
      timeline.push({ name: '4c (Lunch 1)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
    } else if (selectedLunch === "2") {
      timeline.push({ name: 'Period 4a', time: lunchData.period4[0] });
      timeline.push({ name: '4b (Lunch 2)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4b', time: lunchData.period4[1] });
    } else {
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
      timeline.push({ name: '4a (Lunch 3)', time: lunchData.lunch, type: 'lunch' });
    }
    
    timeline.push({ name: 'Period 5', time: daySchedule.period5 });
    timeline.push({ name: 'Period 6', time: daySchedule.period6 });
    if (daySchedule.anchors && daySchedule.anchors.length > 0) {
      timeline.push({ name: 'Anchor Time', time: daySchedule.anchors[0] });
    }
  } 
  else if (week === "Week B" && dayName === "Wednesday") {
    const lunchData = daySchedule.lunch[selectedLunch];
    
    if (selectedLunch === "1") {
      timeline.push({ name: '4c (Lunch 1)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
    } else if (selectedLunch === "2") {
      timeline.push({ name: 'Period 4a', time: lunchData.period4[0] });
      timeline.push({ name: '4b (Lunch 2)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4b', time: lunchData.period4[1] });
    } else {
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
      timeline.push({ name: '4a (Lunch 3)', time: lunchData.lunch, type: 'lunch' });
    }
    
    timeline.push({ name: 'Anchor Time', time: "12:20-12:50" });
    timeline.push({ name: 'Period 5', time: "12:55-1:45" });
    timeline.push({ name: 'Period 6', time: "1:50-2:40" });
  } else {
    const lunchData = daySchedule.lunch[selectedLunch];
    
    if (selectedLunch === "1") {
      timeline.push({ name: '4c (Lunch 1)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
    } else if (selectedLunch === "2") {
      timeline.push({ name: 'Period 4a', time: lunchData.period4[0] });
      timeline.push({ name: '4b (Lunch 2)', time: lunchData.lunch, type: 'lunch' });
      timeline.push({ name: 'Period 4b', time: lunchData.period4[1] });
    } else {
      timeline.push({ name: 'Period 4', time: lunchData.period4 });
      timeline.push({ name: '4a (Lunch 3)', time: lunchData.lunch, type: 'lunch' });
    }
    
    timeline.push({ name: 'Period 5', time: daySchedule.period5 });
    
    if (daySchedule.anchors && daySchedule.anchors.length > 0) {
      if ((week === "Week A" && dayName === "Thursday")) {
        timeline.push({ name: 'Anchor Time', time: daySchedule.anchors[0] });
        timeline.push({ name: 'Period 6', time: daySchedule.period6 });
      } else {
        timeline.push({ name: 'Anchor Time', time: daySchedule.anchors[0] });
        timeline.push({ name: 'Period 6', time: daySchedule.period6 });
      }
    } else {
      timeline.push({ name: 'Period 6', time: daySchedule.period6 });
    }
  }

  const processed = timeline.map(i => ({ ...i, ...parseTimeToMin(i.time) }));
  
  let active = null;
  if (isToday) {
    processed.forEach((ev, idx) => {
      if (currentTime >= ev.start && currentTime < ev.end) active = ev;
      else if (idx < processed.length - 1 && currentTime >= ev.end && currentTime < processed[idx+1].start) {
        active = { name: 'Passing (5 min)', start: ev.end, end: processed[idx+1].start, type: 'passing' };
      }
    });

    processed.forEach(ev => {
      if (currentTime >= ev.end && currentTime < ev.end + 0.04) { 
          const id = ev.name + ev.end;
          if (lastCelebratedPeriodId !== id) { lastCelebratedPeriodId = id; celebrate(); }
      }
    });
  }

  const tbody = document.getElementById('schedule-body');
  let newHtml = "";
  processed.forEach(ev => {
    const isNow = isToday && active && active.start === ev.start && active.name === ev.name;
    // Updated: Use anchor-name class for Anchor Time periods
    const className = ev.type === 'lunch' ? 'lunch-name' : 
                     ev.name.includes('Anchor') ? 'anchor-name' : 'period-name';
    
    newHtml += `<tr class="${isNow ? 'active-row' : ''}">
      <td><span class="${className}">${ev.name}</span></td>
      <td class="time-cell">${formatMinToTime(ev.start)} â€“ ${formatMinToTime(ev.end)}</td>
    </tr>`;
  });
  if (tbody.innerHTML !== newHtml) tbody.innerHTML = newHtml;

  if (isToday && active) {
    const rem = Math.max(0, (active.end - currentTime) * 60);
    const timerHours = Math.floor(rem / 60);
    const timerMinutes = Math.floor(rem % 60);
    
    if (timeFormat === '24hr') {
      document.getElementById('timer').textContent = `${timerHours.toString().padStart(2,'0')}:${timerMinutes.toString().padStart(2,'0')}`;
    } else {
      document.getElementById('timer').textContent = `${timerHours.toString().padStart(2,'0')}:${timerMinutes.toString().padStart(2,'0')}`;
    }
    
    document.getElementById('current-period').textContent = active.name;
    document.getElementById('progress-bar').style.strokeDashoffset = 879.65 - (((currentTime - active.start)/(active.end - active.start)) * 879.65);
    
    // Update timer effects for last minute
    updateTimerEffects(currentTime, active);
  } else if (isToday) {
    document.getElementById('timer').textContent = "00:00";
    document.getElementById('current-period').textContent = currentTime > 880 ? "End of Day" : "Before School";
    document.getElementById('progress-bar').style.strokeDashoffset = 879.65;
    
    // Reset timer effects
    updateTimerEffects(null, null);
  }
}

// Lunch selection event listeners
document.querySelectorAll('input[name="lunch"]').forEach(r => {
  r.addEventListener('change', e => { 
    selectedLunch = e.target.value; 
    localStorage.setItem('mhs_lunch_choice', selectedLunch); 
    update(); 
  });
});

// Initialize
setInterval(update, 1000);
update();
updateSelectedDayIndicator();
</script>
</body>
</html>
